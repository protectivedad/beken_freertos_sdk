from building import *

cwd  = GetCurrentDir()

src_pub = []
src_lib = []
path = []

sys_config = os.path.join(cwd, '..', '..', '..', '..', 'config', 'sys_config.h')
options = LocalOptions(sys_config)

ble_lib_name = 'ble'
platform_match = 'yes'

if (GetLocalDepend(options, 'CFG_SOC_NAME') == 'SOC_BK7238'):
    ble_lib_name += '_7238'
elif (GetLocalDepend(options, 'CFG_SOC_NAME') == 'SOC_BK7252N'):
    ble_lib_name += '_7252n'
elif (GetLocalDepend(options, 'CFG_SOC_NAME') == 'SOC_BK7236'):
    ble_lib_name += '_7236'
else:
    ble_lib_name += '_unknown'
    platform_match = 'no'

if (GetLocalDepend(options, 'CFG_USE_BLE_PS') == 1):
    ble_lib_name += '_ps'

if ((GetLocalDepend(options, 'CFG_SUPPORT_BLE') == 1)
    and (GetLocalDepend(options, 'CFG_BLE_VERSION') == 'BLE_VERSION_5_2')):
    path += [cwd + '/arch/armv5']
    path += [cwd + '/arch/armv5/compiler']
    path += [cwd + '/arch/armv5/ll']
    path += [cwd + '/ble_lib/ip/ahi/api']
    path += [cwd + '/ble_lib/ip/ble/hl/api']
    path += [cwd + '/ble_lib/ip/ble/hl/inc']
    path += [cwd + '/ble_lib/ip/ble/hl/src/gap/gapc']
    path += [cwd + '/ble_lib/ip/ble/hl/src/gap/gapm']
    path += [cwd + '/ble_lib/ip/ble/hl/src/gap']
    path += [cwd + '/ble_lib/ip/ble/hl/src/gatt']
    path += [cwd + '/ble_lib/ip/ble/hl/src/inc']
    path += [cwd + '/ble_lib/ip/ble/hl/src/l2cap']
    path += [cwd + '/ble_lib/ip/ble/iso/data_path']
    path += [cwd + '/ble_lib/ip/ble/iso/data_path/isogen/api']
    path += [cwd + '/ble_lib/ip/ble/iso/data_path/isogen/src']
    path += [cwd + '/ble_lib/ip/ble/iso/data_path/isoohci/api']
    path += [cwd + '/ble_lib/ip/ble/iso/data_path/isoohci/src']
    path += [cwd + '/ble_lib/ip/ble/ll/api']
    path += [cwd + '/ble_lib/ip/ble/ll/import/reg']
    path += [cwd + '/ble_lib/ip/ble/ll/src']
    path += [cwd + '/ble_lib/ip/ble/ll/src/llc']
    path += [cwd + '/ble_lib/ip/ble/ll/src/lld']
    path += [cwd + '/ble_lib/ip/ble/ll/src/lli']
    path += [cwd + '/ble_lib/ip/ble/ll/src/llm']
    path += [cwd + '/ble_lib/ip/em/api']
    path += [cwd + '/ble_lib/ip/hci/api']
    path += [cwd + '/ble_lib/ip/hci/src']
    path += [cwd + '/ble_lib/ip/sch/api']
    path += [cwd + '/ble_lib/ip/sch/import']
    path += [cwd + '/ble_lib/modules/aes/api']
    path += [cwd + '/ble_lib/modules/aes/src']
    path += [cwd + '/ble_lib/modules/common/api']
    path += [cwd + '/ble_lib/modules/dbg/api']
    path += [cwd + '/ble_lib/modules/ecc_p256/api']
    path += [cwd + '/ble_lib/modules/h4tl/api']
    path += [cwd + '/ble_lib/modules/ke/api']
    path += [cwd + '/ble_lib/modules/ke/src']
    path += [cwd + '/ble_lib/modules/rwip/api']
    path += [cwd + '/ble_lib/modules/rwip/import/reg']
    path += [cwd + '/ble_lib/modules/rwip/src']
    path += [cwd + '/ble_pub/app/api']
    path += [cwd + '/ble_pub/profiles/bk_comm/api']
    path += [cwd + '/ble_pub/profiles/bk_sdp/api']
    path += [cwd + '/ble_pub/profiles/bas/bass/api']
    path += [cwd + '/ble_pub/profiles/hogp']
    path += [cwd + '/ble_pub/profiles/hogp/hogpd/api']
    path += [cwd + '/ble_pub/profiles/find/findt/api']
    path += [cwd + '/ble_pub/profiles/dis/diss/api']
    path += [cwd + '/ble_pub/ui']

    src_lib += ["ble_lib/ip/ahi/src/ahi.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/data_path.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isogen/src/isogen.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isogen/src/isogen_rx.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isogen/src/isogen_tx.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isoohci/src/isoohci.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isoohci/src/isoohci_in.c"]
    src_lib += ["ble_lib/ip/ble/iso/data_path/isoohci/src/isoohci_out.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/co/ble_util.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/co/ble_util_buf.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/co/rwble.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_chmap_upd.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_cis.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_clk_acc.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_con_upd.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_cte.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_dbg.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_disconnect.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_dl_upd.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_encrypt.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_feat_exch.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_hci.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_le_ping.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_llcp.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_past.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_phy_upd.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_pwr.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_task.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llc/llc_ver_exch.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_adv.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_bi.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_ci.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_con.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_init.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_iso.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_isoal.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_per_adv.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_scan.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_sync.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lld/lld_test.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_am0.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_bi.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_ci.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_data_path.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_task.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/lli/lli_test.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_adv.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_hci.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_init.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_scan.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_task.c"]
    src_lib += ["ble_lib/ip/ble/ll/src/llm/llm_test.c"]
    src_lib += ["ble_lib/ip/hci/src/hci.c"]
    src_lib += ["ble_lib/ip/hci/src/hci_fc.c"]
    src_lib += ["ble_lib/ip/hci/src/hci_msg.c"]
    src_lib += ["ble_lib/ip/hci/src/hci_tl.c"]
    src_lib += ["ble_lib/ip/sch/src/sch_alarm.c"]
    src_lib += ["ble_lib/ip/sch/src/sch_arb.c"]
    src_lib += ["ble_lib/ip/sch/src/sch_plan.c"]
    src_lib += ["ble_lib/ip/sch/src/sch_prog.c"]
    src_lib += ["ble_lib/ip/sch/src/sch_slice.c"]
    src_lib += ["ble_lib/modules/aes/src/aes.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_c1.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_ccm.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_cmac.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_f4.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_f5.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_f6.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_g2.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_h6.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_h7.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_h8.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_h9.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_k1.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_k2.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_k3.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_k4.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_rpa.c"]
    src_lib += ["ble_lib/modules/aes/src/ble_aes_s1.c"]
    src_lib += ["ble_lib/modules/common/src/common_buf.c"]
    src_lib += ["ble_lib/modules/common/src/common_djob.c"]
    src_lib += ["ble_lib/modules/common/src/common_list.c"]
    src_lib += ["ble_lib/modules/common/src/common_time.c"]
    src_lib += ["ble_lib/modules/common/src/common_utils.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_iqgen.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_mwsgen.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_swdiag.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_task.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_trc.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_trc_mem.c"]
    src_lib += ["ble_lib/modules/dbg/src/dbg_trc_tl.c"]
    src_lib += ["ble_lib/modules/ecc_p256/src/ecc_p256.c"]
    src_lib += ["ble_lib/modules/h4tl/src/h4tl.c"]
    src_lib += ["ble_lib/modules/ke/src/ke.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_event.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_mem.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_msg.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_queue.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_task.c"]
    src_lib += ["ble_lib/modules/ke/src/kernel_timer.c"]
    src_lib += ["ble_lib/modules/rwip/src/rwip.c"]
    src_lib += ["ble_lib/modules/rwip/src/rwip_driver.c"]
    if (GetLocalDepend(options, 'CFG_BLE_HOST_RW') == 1):
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_cli.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_con_up.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_cte.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_disconnect.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_dle.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_info.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_le_ping.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_past.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_phy_up.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_proc.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_pwr_ctrl.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_sdt.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_smp.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_svc.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapc/gapc_task.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_actv.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_addr.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_adv.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_cfg.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_init.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_list.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_per_sync.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_scan.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_smp.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gap/gapm/gapm_task.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_bearer.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_cli_discover.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_cli_event.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_cli_mtu_exch.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_cli_read.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_cli_write.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_db.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_msg.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_proc.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_srv_discover.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_srv_event.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_srv_mtu_exch.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_srv_read.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_srv_write.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/gatt/gatt_user.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/l2cap/l2cap.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/l2cap/l2cap_chan.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/l2cap/l2cap_coc.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/l2cap/l2cap_msg.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/l2cap/l2cap_sig.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/rwble_hl/rwble_hl.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/prf/prf.c"]
        src_lib += ["ble_lib/ip/ble/hl/src/prf/prf_utils.c"]
        src_pub += ["ble_pub/profiles/bk_comm/src/comm.c"]
        src_pub += ["ble_pub/profiles/bk_comm/src/comm_task.c"]
        src_pub += ["ble_pub/profiles/bas/bass/src/bass.c"]
        src_pub += ["ble_pub/profiles/hogp/hogpd/src/hogpd.c"]
        src_pub += ["ble_pub/profiles/find/findt/src/findt.c"]
        src_pub += ["ble_pub/profiles/dis/diss/src/diss.c"]
        src_pub += ["ble_pub/profiles/bk_sdp/src/sdp_common.c"]
        src_pub += ["ble_pub/app/src/app_comm.c"]
        src_pub += ["ble_pub/app/src/app_ble_init.c"]
        src_pub += ["ble_pub/app/src/app_ble.c"]
        src_pub += ["ble_pub/app/src/app_sec.c"]
        src_pub += ["ble_pub/app/src/app_sdp.c"]
        src_pub += ["ble_pub/app/src/app_bass.c"]
        src_pub += ["ble_pub/app/src/app_task.c"]
        src_pub += ["ble_pub/app/src/app_hogpd.c"]
        src_pub += ["ble_pub/app/src/app_findt.c"]
        src_pub += ["ble_pub/app/src/app_diss.c"]
        src_pub += ["ble_pub/ui/ble_ui.c"]

if ((GetLocalDepend(options, 'CFG_SUPPORT_BLE') == 1)
    and (GetLocalDepend(options, 'CFG_SOC_NAME') == 'SOC_BK7238')):
    path += [cwd + '/platform/bk7238/config']
    path += [cwd + '/platform/bk7238/driver/reg']
    path += [cwd + '/platform/bk7238/driver/rf']
    path += [cwd + '/platform/bk7238/driver/uart']
    path += [cwd + '/platform/bk7238/entry']
    path += [cwd + '/platform/bk7238/nvds/api']
    src_pub += ["platform/bk7238/entry/ble_main.c"]
    src_pub += ["platform/bk7238/driver/rf/rf_xvr.c"]
    src_pub += ["platform/bk7238/driver/rf/ble_rf_port.c"]
    src_pub += ["platform/bk7238/driver/uart/uart_ble.c"]

if ((GetLocalDepend(options, 'CFG_SUPPORT_BLE') == 1)
    and (GetLocalDepend(options, 'CFG_SOC_NAME') == 'SOC_BK7252N')):
    path += [cwd + '/platform/bk7252n/config']
    path += [cwd + '/platform/bk7252n/driver/reg']
    path += [cwd + '/platform/bk7252n/driver/rf']
    path += [cwd + '/platform/bk7252n/driver/uart']
    path += [cwd + '/platform/bk7252n/entry']
    path += [cwd + '/platform/bk7252n/nvds/api']
    src_pub += ["platform/bk7252n/entry/ble_main.c"]
    src_pub += ["platform/bk7252n/driver/rf/rf_xvr.c"]
    src_pub += ["platform/bk7252n/driver/rf/ble_rf_port.c"]
    src_pub += ["platform/bk7252n/driver/uart/uart_ble.c"]

libs = [ble_lib_name]
libpath = [cwd + '/']

if (platform_match == 'yes') and (GetLocalDepend(options, 'CFG_SUPPORT_BLE') == 1):
    print('using ble_5_x: lib' + ble_lib_name + '.a')
    group_use_lib = DefineGroup('beken_ble_pub', src_pub, depend = [], CPPPATH = path, LIBS = libs, LIBPATH = libpath)
    group_build_lib = DefineGroup('beken_ble', src_lib, depend = ['BUILD_LIB'], CPPPATH = path, LIBS = libs, LIBPATH = libpath, LIBNAME = 'lib' + ble_lib_name + '.a')
    group = group_use_lib + group_build_lib
else:
    group = []

Return('group')
